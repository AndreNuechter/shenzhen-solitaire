(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const X=""+new URL("service-worker.js",import.meta.url).href;window.navigator.serviceWorker.register(X).catch(console.error);let y;T(),document.addEventListener("visibilitychange",()=>{document.hidden?Z():T()});async function T(){var e,t;y=await((t=(e=navigator.wakeLock)==null?void 0:e.request)==null?void 0:t.call(e,"screen"))}async function Z(){y&&(await y.release(),y=void 0)}const S=[...document.getElementsByClassName("card-slot")],R=[...document.querySelectorAll('[data-slot-type="collection"]')],H=document.getElementsByClassName("consumed"),g=document.getElementById("dealers-hand"),I=[...document.querySelectorAll('[data-slot-type="dragon"]')],q=document.getElementById("dragon-summoning-btns"),ee=document.querySelector('[data-slot-type="flower"]'),f=document.getElementById("proverb-container"),z=document.getElementById("reset-btn"),te=document.getElementById("score-display"),P=[...document.querySelectorAll('[data-slot-type="stacking"]')],u=document.getElementById("table"),N=document.getElementById("win-notification"),O=500,ne={x:0,y:0,rx:5},h=8,oe=128,v="http://www.w3.org/2000/svg",re=(oe+h)*h+h,se=["checked","textContent","data","onpointerdown","onpointerup"];function d(e){return t=>W(e.cloneNode(!1),t)}function W(e,t){return Object.keys(t).forEach(n=>{se.includes(n)?e[n]=t[n]:e.setAttribute(n,t[n])}),e}function j(e,t){return Array.prototype.indexOf.call(e,t)}const ce=JSON.parse(localStorage.getItem("score"))||{score:0},w=new Proxy(ce,{set(e,t,n){return Reflect.set(e,t,n),localStorage.setItem("score",JSON.stringify(e)),!0}}),ae=()=>{H.length===7&&(w.score+=1,te.textContent=`${w.score} time${w.score===1?"":"s"} so far!`,N.style.display="block")},E=e=>{e.classList.add("consumed"),ae()},D=(e,t)=>e.setAttribute("transform",`translate(0,${t*h*2})`),M=({addedNodes:[e]})=>{e.removeAttribute("transform"),e.classList.add("frozen")},ie={collection:e=>t=>{t[0].addedNodes.length&&t.forEach(M),e.children.length===10&&E(e)},dragon:e=>t=>{t[0].addedNodes.length&&t.forEach(({addedNodes:n})=>{n.forEach(s=>D(s,0))}),e.children.length>2&&E(e)},flower:e=>t=>{t[0].addedNodes.length&&(t.forEach(M),E(e))},stacking:e=>t=>{t.forEach(({addedNodes:n})=>{n.forEach(s=>{D(s,j(e.children,s)-1)})})}};S.forEach(e=>{new MutationObserver(ie[e.dataset.slotType](e)).observe(e,{childList:!0})});const le={dragon:(e,t)=>!t.classList.contains("busy")&&e.children.length===1&&t.children.length===1,flower:({children:[{dataset:{color:e,value:t}}]})=>!(t||e),collection:({children:e},{children:t,classList:n})=>{if(e.length!==1||t.length===1&&!n.contains("empty"))return!1;const{color:s,value:o}=e[0].dataset;if(t.length===1&&o==="1")return!0;const{color:r,value:c}=t[t.length-1].dataset;return+o==+c+1&&s===r},stacking:({children:[{dataset:e}]},t)=>{if(t.classList.contains("busy"))return!1;const n=t.children;if(n.length===1)return!0;const{color:s,value:o}=n[n.length-1].dataset,{color:r,value:c}=e;return o&&c?Number(c)===o-1&&r!==s:!1}},de=[/(\d)(,|\))/g,"$1px$2"],x=e=>e.getAttribute("transform").replace(...de),ue=e=>[e,e.getBoundingClientRect()];function fe(e,t){return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}function pe(e,t){return le[t.dataset.slotType](e,t)}function me(e,t,n,s,o,r){return t.classList.add("busy"),()=>{if(n.removeEventListener("pointermove",e),s.children.length===0){t.classList.remove("busy");return}const c=o.map(ue),i=s.getBoundingClientRect(),a=c.filter(([m,_])=>fe(i,_)&&pe(s,m)),p=he(a,i)||t,B=Date.now()-r<O&&p===t,Y=B?m=>p.append(m):m=>A(s,p,m,n),Q=B?0:O;p.classList.add("busy"),[...s.children].forEach(Y),setTimeout(()=>{t.classList.remove("busy"),p.classList.remove("busy")},Q)}}function he(e,t){const n={overlap:0,slot:null};return e.forEach(([s,o])=>{const r=be(t,o);r>n.overlap&&Object.assign(n,{overlap:r,slot:s})}),n.slot}function ge(e,t){return`translate(${e},${t})`}function ye({dataset:{color:e,value:t}},n,s){if(n===s.length-1)return!1;const{color:o,value:r}=s[n+1].dataset;return!r||+r!==t-1||o===e}function be({x:e,y:t,width:n,height:s},{x:o,y:r,width:c,height:i}){const[a,l]=e>o&&t>r?[{x:e,y:t},{x:o+c,y:r+i}]:e<o&&t>r?[{x:o,y:t},{x:e+n,y:r+i}]:e>o&&t<r?[{x:e,y:r},{x:o+c,y:t+s}]:[{x:o,y:r},{x:e+n,y:t+s}];return(l.x-a.x)*(l.y-a.y)}function ve(e,t,n,s,o,r){return r.append(...o),({isPrimary:c,x:i,y:a})=>{c&&r.setAttribute("transform",`${n}${ge((i-e)*s,(a-t)*s)}`)}}function we(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function A(e,t,n,s){const o=x(e)+x(n),r=(t.children.length-1)*h*2*+(t.dataset.slotType==="stacking"),c=`${x(t)}translateY(${r}px)`,i=[e,t,n,q];t.classList.remove("empty"),i.forEach(a=>{a.style.pointerEvents="none"}),s.append(n),n.animate({transform:[o,c],easing:["ease-in","ease-out"]},O).addEventListener("finish",()=>{t.append(n),i.forEach(a=>a.removeAttribute("style"))},{once:!0})}const G=document.createElementNS(v,"g"),Ee=W(document.createElementNS(v,"rect"),ne),$=document.createElementNS(v,"text"),xe=document.createElementNS(v,"use"),C={red:"#famine",black:"#war",green:"#biohazard",dragon:"#skull",flower:"#flower"},L=(e,t,n)=>{const s=G.cloneNode(!1),o=d(xe)({width:"16px",height:"16px",href:e,stroke:t,fill:t}),r=d(o)({x:"4px",y:"4px"}),c=d(o)({x:"109px",y:"160px"}),i=d(o)({x:"32px",y:"60px",width:"64px",height:"64px"}),a=d($)({x:"24px",y:"16px",textContent:n}),l=d($)({x:"96px",y:"173px",textContent:n});return s.append(r,c,i,a,l),s},V=(e,t)=>{const n=d(G)({class:"card"}),s=Ee.cloneNode(!1),o=t?L(C[e],e,t):e?L(C.dragon,e):L(C.flower,"hotpink");return n.append(s,o),Object.assign(n.dataset,{color:e,value:t}),n},b=["black","red","green"].flatMap(e=>Array.from({length:13},(t,n)=>V(e,n<=8?n+1:"")));b.push(V("",""));let J;function Ce({x:e,y:t}){const n=document.elementFromPoint(e,t).closest(".card");if(!n)return;const s=n.parentElement;if(["flower","collection"].includes(s.dataset.slotType)||s.lastChild!==n)return;const{color:o,value:r}=n.dataset;if(!r&&o)return;const c=(()=>{if(!r)return ee;const i=r==="1"?a=>a.classList.contains("empty"):({lastChild:{dataset:{color:a,value:l}}})=>a===o&&+l===r-1;return R.find(i)})();c&&(c.classList.remove("empty"),A(s,c,n,u))}function K(e){we(e).forEach((t,n)=>P[n%8].append(t))}function Le({target:e,x:t,y:n}){if(g.children.length)return;const s=e.closest(".card");if(!s)return;const o=s.parentNode;if(!o.classList.contains("card-slot"))return;const r=[...o.children].slice(j(o.children,s));if(r.some(ye))return;const c=o.getAttribute("transform"),i=Date.now(),a=ve(t,n,c,J,r,g);g.setAttribute("transform",c),u.addEventListener("pointermove",a,{passive:!0}),u.addEventListener("pointerup",me(a,o,u,g,S,i),{once:!0})}function ke(){N.style.display="",b.forEach(e=>e.classList.remove("frozen")),S.forEach(e=>e.classList.remove("consumed")),R.forEach(e=>e.classList.add("empty")),K(b)}function U(){J=+(re/u.clientWidth).toFixed(2)}function Oe({target:e}){const t=e.closest(".dragon-summoning-btn");if(!t)return;const{color:n}=t.dataset,s=[...P,...I].reduce((r,{children:c})=>{const{color:i,value:a}=c[c.length-1].dataset;return i===n&&!a&&r.push(c[c.length-1]),r},[]);if(s.length!==4)return;const o=I.find(({children:r})=>r.length===1||!r[1].dataset.value&&r[1].dataset.color===n);o&&s.forEach((r,c)=>{r.classList.add("frozen"),setTimeout(()=>A(r.parentElement,o,r,u),25*c)})}function k({target:e,type:t}){const n=e.closest(".dragon-summoning-btn");n&&n.classList[["pointerout","pointerup"].includes(t)?"remove":"add"]("clicked")}const F=["At the gambling table, there are no fathers and sons.","Reform a gambler. Cure leprosy.","A pack of cards is the devil's prayer-book.","Rich gamblers and old trumpeters are rare.","Luck never gives; it only lends.","Before you gamble: Know the rules, the stakes and predetermine the quitting time.","Gambling: The sure way of getting nothing for something.","The highest form of wisdom is to know when to play and when to stay away.","If you can't spot the sucker in the first half hour at the table, then you are the sucker.","Gambling is not about money; it is about the thrill of the risk.","Hedging is for gardeners.","You can't win if you don't play","Luck is probability taken personally","Quit while you're ahead. All the best gamblers do."];Object.assign(q,{onclick:Oe,onpointerdown:k,onpointerup:k,onpointerout:k});z.onclick=ke;u.addEventListener("pointerdown",Le,{passive:!0});N.onclick=()=>z.click();f.onclick=()=>{f.style.display=""};window.addEventListener("DOMContentLoaded",()=>{f.textContent=F[Math.trunc(Math.random()*F.length)],f.style.display="block",f.classList.add("fade"),setTimeout(()=>{f.style.display=""},5e3),K(b),U()},{once:!0});window.onresize=U;window.ondblclick=Ce;
