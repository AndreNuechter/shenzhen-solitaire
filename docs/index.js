(()=>{"use strict";var e={283:(e,t,n)=>{n.d(t,{BS:()=>r,H9:()=>o,VL:()=>c,Zy:()=>a,ns:()=>s});const o=500,r={x:0,y:0,rx:5},a=8,s="http://www.w3.org/2000/svg",c=(128+a)*a+a},712:(e,t,n)=>{n.d(t,{GP:()=>r,Js:()=>u,KR:()=>i,YO:()=>l,c1:()=>a,hN:()=>c,mM:()=>o,oJ:()=>p,tp:()=>h,uY:()=>s,uo:()=>d,y1:()=>f});const o=[...document.getElementsByClassName("card-slot")],r=[...document.querySelectorAll('[data-slot-type="collection"]')],a=document.getElementsByClassName("consumed"),s=document.getElementById("dealers-hand"),c=[...document.querySelectorAll('[data-slot-type="dragon"]')],l=document.getElementById("dragon-summoning-btns"),i=document.querySelector('[data-slot-type="flower"]'),d=document.getElementById("reset-btn"),u=document.getElementById("score-display"),p=[...document.querySelectorAll('[data-slot-type="stacking"]')],h=document.getElementById("table"),f=document.getElementById("win-notification")},952:(e,t,n)=>{n.d(t,{G1:()=>s,Vc:()=>a,ee:()=>r});const o=["checked","textContent","data","onpointerdown","onpointerup"];function r(e){return t=>a(e.cloneNode(!1),t)}function a(e,t){return Object.keys(t).forEach((n=>{o.includes(n)?e[n]=t[n]:e.setAttribute(n,t[n])})),e}function s(e,t){return Array.prototype.indexOf.call(e,t)}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{(async()=>{if(!("wakeLock"in navigator)||!("request"in navigator.wakeLock))return;const e=()=>navigator.wakeLock.request("screen");await e(),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await e()}))})();var e=n(712),t=n(283);const o={dragon:(e,t)=>1===e.children.length&&1===t.children.length,flower:({children:[{dataset:{color:e,value:t}}]})=>!(Boolean(t)||Boolean(e)),collection:({children:e},{children:t})=>{if(1!==e.length)return!1;const{color:n,value:o}=e[0].dataset;if(1===t.length&&"1"===o)return!0;const{color:r,value:a}=t[t.length-1].dataset;return+o==+a+1&&n===r},stacking:({children:[{dataset:e}]},{children:t})=>{if(1===t.length)return!0;const{color:n,value:o}=t[t.length-1].dataset,{color:r,value:a}=e;return!(!o||!a)&&Number(a)===o-1&&r!==n}},r=[/(\d)(,|\))/g,"$1px$2"],a=e=>e.getAttribute("transform").replace(...r),s=e=>[e,e.getBoundingClientRect()];function c({dataset:{color:e,value:t}},n,o){if(n===o.length-1)return!1;const{color:r,value:a}=o[n+1].dataset;return!a||+a!=t-1||r===e}function l(n,o,r,s){const c=a(n)+a(r),l=(o.children.length-1)*t.Zy*2*Number("stacking"===o.dataset.slotType),i=`${a(o)}translateY(${l}px)`,d=[n,o,r,e.YO];d.forEach((e=>{e.style.pointerEvents="none"})),s.append(r),r.animate({transform:[c,i],easing:["ease-in","ease-out"]},t.H9).addEventListener("finish",(()=>{o.append(r),d.forEach((e=>e.removeAttribute("style")))}),{once:!0})}var i=n(952);const d=document.createElementNS(t.ns,"g"),u=(0,i.Vc)(document.createElementNS(t.ns,"rect"),t.BS),p=document.createElementNS(t.ns,"text"),h=document.createElementNS(t.ns,"use"),f={red:"#famine",black:"#war",green:"#biohazard",dragon:"#skull",flower:"#flower"},m=(e,t,n)=>{const o=d.cloneNode(!1),r=(0,i.ee)(h)({width:"16px",height:"16px",href:e,stroke:t,fill:t}),a=(0,i.ee)(r)({x:"4px",y:"4px"}),s=(0,i.ee)(r)({x:"109px",y:"160px"}),c=(0,i.ee)(r)({x:"32px",y:"60px",width:"64px",height:"64px"}),l=(0,i.ee)(p)({x:"24px",y:"16px",textContent:n}),u=(0,i.ee)(p)({x:"96px",y:"173px",textContent:n});return o.append(a,s,c,l,u),o},g=(e,t)=>{const n=(0,i.ee)(d)({class:"card"}),o=u.cloneNode(!1),r=t?m(f[e],e,t):e?m(f.dragon,e):m(f.flower,"hotpink");return n.append(o,r),Object.assign(n.dataset,{color:e,value:t}),n},y=["black","red","green"].flatMap((e=>Array.from({length:13},((t,n)=>g(e,n<=8?n+1:"")))));y.push(g("",""));const v=y;let x;function w(t){(function(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e})(t).forEach(((t,n)=>e.oJ[n%8].append(t)))}function E(){x=+(t.VL/e.tp.clientWidth).toFixed(2)}function b({target:e,type:t}){const n=e.closest(".dragon-summoning-btn");n&&n.classList[["pointerout","pointerup"].includes(t)?"remove":"add"]("clicked")}Object.assign(e.YO,{onclick:function({target:t}){const n=t.closest(".dragon-summoning-btn");if(!n)return;const{color:o}=n.dataset,r=[...e.oJ,...e.hN].reduce(((e,{children:t})=>{const{color:n,value:r}=t[t.length-1].dataset;return n!==o||r||e.push(t[t.length-1]),e}),[]),a=e.hN.find((({children:e})=>1===e.length||!e[1].dataset.value&&e[1].dataset.color===o));4===r.length&&a&&r.forEach(((t,n)=>{t.classList.add("frozen"),setTimeout((()=>l(t.parentElement,a,t,e.tp)),25*n)}))},onpointerdown:b,onpointerup:b,onpointerout:b}),e.uo.onclick=function(){e.y1.style.display="",e.mM.forEach((e=>e.classList.remove("consumed"))),v.forEach((e=>e.classList.remove("frozen"))),e.GP.forEach((e=>e.classList.add("empty"))),w(v)},e.tp.addEventListener("pointerdown",(function({target:n,x:r,y:a}){if(e.uY.children.length)return;const d=n.closest(".card");if(!d)return;const u=d.parentNode;if(!u.classList.contains("card-slot"))return;const p=[...u.children].slice((0,i.G1)(u.children,d));if(p.some(c))return;const h=u.getAttribute("transform"),f=Date.now(),m=function(e,t,n,o,r,a){return s=>{if(!s.isPrimary)return;const c=s.x,l=s.y;var i,d;a.children.length||a.append(...r),a.setAttribute("transform",`${n}${i=(c-e)*o,d=(l-t)*o,`translate(${i},${d})`}`)}}(r,a,h,x,p,e.uY);e.uY.setAttribute("transform",h),e.tp.addEventListener("pointermove",m,{passive:!0}),e.tp.addEventListener("pointerup",function(e,n,r,a,c,i){return()=>{if(r.removeEventListener("pointermove",e),0===a.children.length)return;const d=c.map(s),u=a.getBoundingClientRect(),p=d.filter((([e,t])=>{return r=t,!((n=u).right<r.left||n.left>r.right||n.bottom<r.top||n.top>r.bottom)&&function(e,t){return o[t.dataset.slotType](e,t)}(a,e);var n,r})),h=function(e,t){const n={overlap:0,slot:null};return e.forEach((([e,o])=>{const r=function({x:e,y:t,width:n,height:o},{x:r,y:a,width:s,height:c}){const[l,i]=e>r&&t>a?[{x:e,y:t},{x:r+s,y:a+c}]:e<r&&t>a?[{x:r,y:t},{x:e+n,y:a+c}]:e>r&&t<a?[{x:e,y:a},{x:r+s,y:t+o}]:[{x:r,y:a},{x:e+n,y:t+o}];return(i.x-l.x)*(i.y-l.y)}(t,o);r>n.overlap&&Object.assign(n,{overlap:r,slot:e})})),n.slot}(p,u),f=h||n,m=Date.now()-i<t.H9&&f===n?e=>f.append(e):e=>l(a,f,e,r);[...a.children].forEach(m)}}(m,u,e.tp,e.uY,e.mM,f),{once:!0})}),{passive:!0}),e.y1.onclick=()=>e.uo.click(),window.addEventListener("DOMContentLoaded",(()=>{w(v),E(),"serviceWorker"in window.navigator&&window.navigator.serviceWorker.register("./service-worker.js")}),{once:!0}),window.onresize=E,window.ondblclick=function({x:t,y:n}){const o=document.elementFromPoint(t,n).closest(".card");if(!o)return;const r=o.parentElement;if(["flower","collection"].includes(r.dataset.slotType))return;if(r.lastChild!==o)return;const{color:a,value:s}=o.dataset;if(!s&&a)return;const c=(()=>{if(!s)return e.KR;const t="1"===s?e=>e.classList.contains("empty"):({lastChild:{dataset:{color:e,value:t}}})=>e===a&&+t==s-1;return e.GP.find(t)})();c&&(c.classList.remove("empty"),l(r,c,o,e.tp))}})(),(()=>{var e=n(712),t=n(283),o=n(952);const r=JSON.parse(localStorage.getItem("score"))||{score:0},a=new Proxy(r,{set:(e,t,n)=>(Reflect.set(e,t,n),localStorage.setItem("score",JSON.stringify(e)),!0)}),s=t=>{t.classList.add("consumed"),7===e.c1.length&&(a.score+=1,e.Js.textContent=`${a.score} time${1===a.score?"":"s"} so far!`,e.y1.style.display="block")},c=(e,n)=>e.setAttribute("transform",`translate(0,${n*t.Zy*2})`),l=({addedNodes:[e]})=>{e.removeAttribute("transform"),e.classList.add("frozen")},i={collection:e=>t=>{t[0].addedNodes.length&&t.forEach(l),10===e.children.length&&s(e)},dragon:e=>t=>{t[0].addedNodes.length&&t.forEach((({addedNodes:e})=>{e.forEach((e=>c(e,0)))})),e.children.length>2&&s(e)},flower:e=>t=>{t[0].addedNodes.length&&(t.forEach(l),s(e))},stacking:e=>t=>{t.forEach((({addedNodes:t})=>{t.forEach((t=>{c(t,(0,o.G1)(e.children,t)-1)}))}))}};e.mM.forEach((e=>{new MutationObserver(i[e.dataset.slotType](e)).observe(e,{childList:!0})}))})()})();