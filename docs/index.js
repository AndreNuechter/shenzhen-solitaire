(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const Z=""+new URL("service-worker.js",import.meta.url).href;window.navigator.serviceWorker.register(Z).catch(console.error);let y;T(),document.addEventListener("visibilitychange",()=>{document.hidden?H():T()});async function T(){var e,t;y=await((t=(e=navigator.wakeLock)==null?void 0:e.request)==null?void 0:t.call(e,"screen"))}async function H(){y&&(await y.release(),y=void 0)}const S=[...document.getElementsByClassName("card-slot")],R=[...document.querySelectorAll('[data-slot-type="collection"]')],ee=document.getElementsByClassName("consumed"),g=document.getElementById("dealers-hand"),I=[...document.querySelectorAll('[data-slot-type="dragon"]')],q=document.getElementById("dragon-summoning-btns"),te=document.querySelector('[data-slot-type="flower"]'),m=document.getElementById("proverb-container"),ne=document.getElementById("reset-btn"),oe=document.getElementById("score-display"),z=[...document.querySelectorAll('[data-slot-type="stacking"]')],u=document.getElementById("table"),N=document.getElementById("win-notification"),k=500,re={x:0,y:0,rx:5},h=8,se=128,v="http://www.w3.org/2000/svg",ce=(se+h)*h+h,ae=["checked","textContent","data","onpointerdown","onpointerup"];function d(e){return t=>P(e.cloneNode(!1),t)}function P(e,t){return Object.keys(t).forEach(n=>{ae.includes(n)?e[n]=t[n]:e.setAttribute(n,t[n])}),e}function W(e,t){return Array.prototype.indexOf.call(e,t)}const ie=JSON.parse(localStorage.getItem("score"))||{score:0},w=new Proxy(ie,{set(e,t,n){return Reflect.set(e,t,n),localStorage.setItem("score",JSON.stringify(e)),!0}}),le=()=>{ee.length===7&&(w.score+=1,oe.textContent=`${w.score} time${w.score===1?"":"s"} so far!`,N.style.display="block")},E=e=>{e.classList.add("consumed"),le()},D=(e,t)=>e.setAttribute("transform",`translate(0,${t*h*2})`),M=({addedNodes:[e]})=>{e.removeAttribute("transform"),e.classList.add("frozen")},de={collection:e=>t=>{t[0].addedNodes.length&&t.forEach(M),e.children.length===10&&E(e)},dragon:e=>t=>{t[0].addedNodes.length&&t.forEach(({addedNodes:n})=>{n.forEach(s=>D(s,0))}),e.children.length>2&&E(e)},flower:e=>t=>{t[0].addedNodes.length&&(t.forEach(M),E(e))},stacking:e=>t=>{t.forEach(({addedNodes:n})=>{n.forEach(s=>{D(s,W(e.children,s)-1)})})}};S.forEach(e=>{new MutationObserver(de[e.dataset.slotType](e)).observe(e,{childList:!0})});const ue={dragon:(e,t)=>!t.classList.contains("busy")&&e.children.length===1&&t.children.length===1,flower:({children:[{dataset:{color:e,value:t}}]})=>!(t||e),collection:({children:e},{children:t,classList:n})=>{if(e.length!==1||t.length===1&&!n.contains("empty"))return!1;const{color:s,value:o}=e[0].dataset;if(t.length===1&&o==="1")return!0;const{color:r,value:c}=t[t.length-1].dataset;return+o==+c+1&&s===r},stacking:({children:[{dataset:e}]},t)=>{if(t.classList.contains("busy"))return!1;const n=t.children;if(n.length===1)return!0;const{color:s,value:o}=n[n.length-1].dataset,{color:r,value:c}=e;return o&&c?Number(c)===o-1&&r!==s:!1}},fe=[/(\d)(,|\))/g,"$1px$2"],L=e=>e.getAttribute("transform").replace(...fe),pe=e=>[e,e.getBoundingClientRect()];function me(e,t){return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}function he(e,t){return ue[t.dataset.slotType](e,t)}function ge(e,t,n,s,o,r){return t.classList.add("busy"),()=>{if(n.removeEventListener("pointermove",e),s.children.length===0){t.classList.remove("busy");return}const c=o.map(pe),i=s.getBoundingClientRect(),a=c.filter(([p,X])=>me(i,X)&&he(s,p)),f=ye(a,i)||t,B=Date.now()-r<k&&f===t,Q=B?p=>f.append(p):p=>A(s,f,p,n),_=B?0:k;f.classList.add("busy"),[...s.children].forEach(Q),setTimeout(()=>{t.classList.remove("busy"),f.classList.remove("busy")},_)}}function ye(e,t){const n={overlap:0,slot:null};return e.forEach(([s,o])=>{const r=we(t,o);r>n.overlap&&Object.assign(n,{overlap:r,slot:s})}),n.slot}function be(e,t){return`translate(${e},${t})`}function ve({dataset:{color:e,value:t}},n,s){if(n===s.length-1)return!1;const{color:o,value:r}=s[n+1].dataset;return!r||+r!==t-1||o===e}function we({x:e,y:t,width:n,height:s},{x:o,y:r,width:c,height:i}){const[a,l]=e>o&&t>r?[{x:e,y:t},{x:o+c,y:r+i}]:e<o&&t>r?[{x:o,y:t},{x:e+n,y:r+i}]:e>o&&t<r?[{x:e,y:r},{x:o+c,y:t+s}]:[{x:o,y:r},{x:e+n,y:t+s}];return(l.x-a.x)*(l.y-a.y)}function Ee(e,t,n,s,o,r){return r.append(...o),({isPrimary:c,x:i,y:a})=>{c&&r.setAttribute("transform",`${n}${be((i-e)*s,(a-t)*s)}`)}}function Le(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function A(e,t,n,s){const o=L(e)+L(n),r=(t.children.length-1)*h*2*+(t.dataset.slotType==="stacking"),c=`${L(t)}translateY(${r}px)`,i=[e,t,n,q];t.classList.remove("empty"),i.forEach(a=>{a.style.pointerEvents="none"}),s.append(n),n.animate({transform:[o,c],easing:["ease-in","ease-out"]},k).addEventListener("finish",()=>{t.append(n),i.forEach(a=>a.removeAttribute("style"))},{once:!0})}const j=document.createElementNS(v,"g"),xe=P(document.createElementNS(v,"rect"),re),$=document.createElementNS(v,"text"),Ce=document.createElementNS(v,"use"),x={red:"#famine",black:"#war",green:"#biohazard",dragon:"#skull",flower:"#flower"},C=(e,t,n)=>{const s=j.cloneNode(!1),o=d(Ce)({width:"16px",height:"16px",href:e,stroke:t,fill:t}),r=d(o)({x:"4px",y:"4px"}),c=d(o)({x:"109px",y:"160px"}),i=d(o)({x:"32px",y:"60px",width:"64px",height:"64px"}),a=d($)({x:"24px",y:"16px",textContent:n}),l=d($)({x:"96px",y:"173px",textContent:n});return s.append(r,c,i,a,l),s},G=(e,t)=>{const n=d(j)({class:"card"}),s=xe.cloneNode(!1),o=t?C(x[e],e,t):e?C(x.dragon,e):C(x.flower,"hotpink");return n.append(s,o),Object.assign(n.dataset,{color:e,value:t}),n},b=["black","red","green"].flatMap(e=>Array.from({length:13},(t,n)=>G(e,n<=8?n+1:"")));b.push(G("",""));let V;function Oe({x:e,y:t}){const n=document.elementFromPoint(e,t).closest(".card");if(!n)return;const s=n.parentElement;if(["flower","collection"].includes(s.dataset.slotType)||s.lastChild!==n)return;const{color:o,value:r}=n.dataset;if(!r&&o)return;const c=(()=>{if(!r)return te;const i=r==="1"?a=>a.classList.contains("empty"):({lastChild:{dataset:{color:a,value:l}}})=>a===o&&+l===r-1;return R.find(i)})();c&&(c.classList.remove("empty"),A(s,c,n,u))}function J(e){Le(e).forEach((t,n)=>z[n%8].append(t))}function ke({target:e,x:t,y:n}){if(g.children.length)return;const s=e.closest(".card");if(!s)return;const o=s.parentNode;if(!o.classList.contains("card-slot"))return;const r=[...o.children].slice(W(o.children,s));if(r.some(ve))return;const c=o.getAttribute("transform"),i=Date.now(),a=Ee(t,n,c,V,r,g);g.setAttribute("transform",c),u.addEventListener("pointermove",a,{passive:!0}),u.addEventListener("pointerup",ge(a,o,u,g,S,i),{once:!0})}function K(){N.style.display="",b.forEach(e=>e.classList.remove("frozen")),S.forEach(e=>e.classList.remove("consumed")),R.forEach(e=>e.classList.add("empty")),J(b)}function U(){V=+(ce/u.clientWidth).toFixed(2)}function Se({target:e}){const t=e.closest(".dragon-summoning-btn");if(!t)return;const{color:n}=t.dataset,s=[...z,...I].reduce((r,{children:c})=>{const{color:i,value:a}=c[c.length-1].dataset;return i===n&&!a&&r.push(c[c.length-1]),r},[]);if(s.length!==4)return;const o=I.find(({children:r})=>r.length===1||!r[1].dataset.value&&r[1].dataset.color===n);o&&s.forEach((r,c)=>{r.classList.add("frozen"),setTimeout(()=>A(r.parentElement,o,r,u),25*c)})}function O({target:e,type:t}){const n=e.closest(".dragon-summoning-btn");n&&n.classList[["pointerout","pointerup"].includes(t)?"remove":"add"]("clicked")}const F=["At the gambling table, there are no fathers and sons.","Reform a gambler. Cure leprosy.","A pack of cards is the devil's prayer-book.","Rich gamblers and old trumpeters are rare.","Luck never gives; it only lends.","Before you gamble: Know the rules, the stakes and predetermine the quitting time.","Gambling: The sure way of getting nothing for something.","The highest form of wisdom is to know when to play and when to stay away.","If you can't spot the sucker in the first half hour at the table, then you are the sucker.","Gambling is not about money; it is about the thrill of the risk.","Hedging is for gardeners.","You can't win if you don't play","Luck is probability taken personally","Quit while you're ahead. All the best gamblers do."];window.addEventListener("DOMContentLoaded",()=>{m.textContent=F[Math.trunc(Math.random()*F.length)],m.style.display="block",m.classList.add("fade"),setTimeout(Y,5e3),J(b),U()},{once:!0});window.addEventListener("resize",U);window.addEventListener("dblclick",Oe);ne.addEventListener("click",K);u.addEventListener("pointerdown",ke,{passive:!0});N.addEventListener("click",K);m.addEventListener("click",Y);Object.assign(q,{onclick:Se,onpointerdown:O,onpointerup:O,onpointerout:O});function Y(){m.style.display=""}
