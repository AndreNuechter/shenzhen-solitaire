(()=>{"use strict";var e={975:(e,t,n)=>{n.d(t,{wy:()=>o,Hv:()=>r,Ks:()=>s,ns:()=>a,bf:()=>c});const o=500,r={x:0,y:0,rx:5},s=8,a="http://www.w3.org/2000/svg",c=(128+s)*s+s},5:(e,t,n)=>{n.d(t,{VY:()=>o,Jm:()=>r,u5:()=>s,Ee:()=>a,lI:()=>c,wm:()=>l,zu:()=>i,Nk:()=>d,Dy:()=>u,WP:()=>f,Kz:()=>h,KU:()=>p});const o=[...document.getElementsByClassName("card-slot")],r=[...document.querySelectorAll('[data-slot-type="collection"]')],s=document.getElementsByClassName("consumed"),a=document.getElementById("dealers-hand"),c=[...document.querySelectorAll('[data-slot-type="dragon"]')],l=document.getElementById("dragon-summoning-btns"),i=document.querySelector('[data-slot-type="flower"]'),d=document.getElementById("reset-btn"),u=document.getElementById("score-display"),f=[...document.querySelectorAll('[data-slot-type="stacking"]')],h=document.getElementById("table"),p=document.getElementById("win-notification")},460:(e,t,n)=>{n.d(t,{T$:()=>r,oN:()=>s,O:()=>a});const o=["checked","textContent","data","onpointerdown","onpointerup"];function r(e){return t=>s(e.cloneNode(!1),t)}function s(e,t){return Object.keys(t).forEach((n=>{o.includes(n)?e[n]=t[n]:e.setAttribute(n,t[n])})),e}function a(e,t){return Array.prototype.indexOf.call(e,t)}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{(async()=>{if(!("wakeLock"in navigator)||!("request"in navigator.wakeLock))return;const e=()=>navigator.wakeLock.request("screen");await e(),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await e()}))})();var e=n(5),t=n(975);const o={dragon:(e,t)=>1===e.children.length&&1===t.children.length,flower:({children:[{dataset:{color:e,value:t}}]})=>!t&&!e,collection:({children:e},{children:t})=>{const{color:n,value:o}=e[0].dataset,{color:r,value:s}=t[t.length-1].dataset;return 1===e.length&&(1===t.length&&"1"===o||+o==+s+1&&n===r)},stacking:({children:[{dataset:e}]},{children:t})=>{const{color:n,value:o}=t[t.length-1].dataset,{color:r,value:s}=e;return 1===t.length||!(!o||!s)&&+s==o-1&&r!==n}},r=[/(\d)(,|\))/g,"$1px$2"],s=e=>e.getAttribute("transform").replace(...r),a=e=>[e,e.getBoundingClientRect()];function c({dataset:{color:e,value:t}},n,o){if(n===o.length-1)return!1;const{color:r,value:s}=o[n+1].dataset;return!s||+s!=t-1||r===e}function l(n,o,r,a){const c=s(n)+s(r),l=(o.children.length-1)*t.Ks*2*Number("stacking"===o.dataset.slotType),i=`${s(o)}translateY(${l}px)`,d=[n,o,r,e.wm];d.forEach((e=>{e.style.pointerEvents="none"})),a.append(r),r.animate({transform:[c,i],easing:["ease-in","ease-out"]},t.wy).addEventListener("finish",(()=>{o.append(r),d.forEach((e=>e.removeAttribute("style")))}),{once:!0})}var i=n(460);const d=document.createElementNS(t.ns,"g"),u=(0,i.oN)(document.createElementNS(t.ns,"rect"),t.Hv),f=document.createElementNS(t.ns,"text"),h=document.createElementNS(t.ns,"use"),p={red:"#famine",black:"#war",green:"#biohazard",dragon:"#skull",flower:"#flower"},m=(e,t,n)=>{const o=d.cloneNode(!1),r=(0,i.T$)(h)({width:"16px",height:"16px",href:e,stroke:t,fill:t}),s=(0,i.T$)(r)({x:"4px",y:"4px"}),a=(0,i.T$)(r)({x:"109px",y:"160px"}),c=(0,i.T$)(r)({x:"32px",y:"60px",width:"64px",height:"64px"}),l=(0,i.T$)(f)({x:"24px",y:"16px",textContent:n}),u=(0,i.T$)(f)({x:"96px",y:"173px",textContent:n});return o.append(s,a,c,l,u),o},g=(e,t)=>{const n=(0,i.T$)(d)({class:"card"}),o=u.cloneNode(!1),r=t?m(p[e],e,t):e?m(p.dragon,e):m(p.flower,"hotpink");return n.append(o,r),Object.assign(n.dataset,{color:e,value:t}),n},y=["black","red","green"].flatMap((e=>Array.from({length:13},((t,n)=>g(e,n<=8?n+1:"")))));y.push(g("",""));const v=y;let x;function w(t){(function(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e})(t).forEach(((t,n)=>e.WP[n%8].append(t)))}function E(){x=+(t.bf/e.Kz.clientWidth).toFixed(2)}function b({target:e,type:t}){const n=e.closest(".dragon-summoning-btn");n&&(["pointerout","pointerup"].includes(t)?n.classList.remove("clicked"):n.classList.add("clicked"))}Object.assign(e.wm,{onclick:function({target:t}){const n=t.closest(".dragon-summoning-btn");if(!n)return;const{color:o}=n.dataset,r=[...e.WP,...e.lI].reduce(((e,{children:t})=>{const{color:n,value:r}=t[t.length-1].dataset;return n!==o||r||e.push(t[t.length-1]),e}),[]),s=e.lI.find((({children:e})=>1===e.length||!e[1].dataset.value&&e[1].dataset.color===o));if(4===r.length&&s){const t=(t,n)=>{t.classList.add("frozen"),setTimeout((()=>l(t.parentElement,s,t,e.Kz)),25*n)};r.forEach(t)}},onpointerdown:b,onpointerup:b,onpointerout:b}),e.Nk.onclick=function(){e.KU.style.display="",e.VY.forEach((e=>e.classList.remove("consumed"))),v.forEach((e=>e.classList.remove("frozen"))),e.Jm.forEach((e=>e.classList.add("empty"))),w(v)},e.Kz.addEventListener("pointerdown",(function({target:n,x:r,y:s}){if(e.Ee.children.length)return;const d=n.closest(".card");if(!d)return;const u=d.parentNode;if(!u.classList.contains("card-slot"))return;const f=[...u.children].slice((0,i.O)(u.children,d));if(f.some(c))return;const h=u.getAttribute("transform"),p=Date.now(),m=function(e,t,n,o,r,s){return a=>{if(!a.isPrimary)return;const c=a.x,l=a.y;var i,d;s.children.length||s.append(...r),s.setAttribute("transform",`${n}${i=(c-e)*o,d=(l-t)*o,`translate(${i},${d})`}`)}}(r,s,h,x,f,e.Ee);e.Ee.setAttribute("transform",h),e.Kz.addEventListener("pointermove",m,{passive:!0}),e.Kz.addEventListener("pointerup",function(e,n,r,s,c,i){return()=>{if(r.removeEventListener("pointermove",e),!s.children.length)return;const d=c.map(a),u=s.getBoundingClientRect(),f=d.filter((([e,t])=>{return r=t,!((n=u).right<r.left||n.left>r.right||n.bottom<r.top||n.top>r.bottom)&&function(e,t){return o[t.dataset.slotType](e,t)}(s,e);var n,r})),h=function(e,t){const n={overlap:0,slot:null};return e.forEach((([e,o])=>{const r=function({x:e,y:t,width:n,height:o},{x:r,y:s,width:a,height:c}){const[l,i]=e>r&&t>s?[{x:e,y:t},{x:r+a,y:s+c}]:e<r&&t>s?[{x:r,y:t},{x:e+n,y:s+c}]:e>r&&t<s?[{x:e,y:s},{x:r+a,y:t+o}]:[{x:r,y:s},{x:e+n,y:t+o}];return(i.x-l.x)*(i.y-l.y)}(t,o);r>n.overlap&&Object.assign(n,{overlap:r,slot:e})})),n.slot}(f,u),p=h||n,m=Date.now()-i<t.wy&&p===n?e=>p.append(e):e=>l(s,p,e,r);[...s.children].forEach(m)}}(m,u,e.Kz,e.Ee,e.VY,p),{once:!0})}),{passive:!0}),e.KU.onclick=()=>e.Nk.click(),window.addEventListener("DOMContentLoaded",(()=>{w(v),E(),"serviceWorker"in window.navigator&&window.navigator.serviceWorker.register("./service-worker.js")}),{once:!0}),window.onresize=E,window.ondblclick=function({x:t,y:n}){const o=document.elementFromPoint(t,n).closest(".card");if(!o)return;const r=o.parentElement;if(["flower","collection"].includes(r.dataset.slotType))return;if(r.lastChild!==o)return;const{color:s,value:a}=o.dataset;if(!a&&s)return;const c=(()=>{if(!a)return e.zu;const t="1"===a?e=>e.classList.contains("empty"):({lastChild:{dataset:{color:e,value:t}}})=>e===s&&+t==a-1;return e.Jm.find(t)})();c&&(c.classList.remove("empty"),l(r,c,o,e.Kz))}})(),(()=>{var e=n(5),t=n(975),o=n(460);const r=JSON.parse(localStorage.getItem("score"))||{score:0},s=new Proxy(r,{set:(e,t,n)=>(Reflect.set(e,t,n),localStorage.setItem("score",JSON.stringify(e)),!0)}),a=t=>{t.classList.add("consumed"),7===e.u5.length&&(s.score+=1,e.Dy.textContent=`${s.score} time${1===s.score?"":"s"} so far!`,e.KU.style.display="block")},c=(e,n)=>e.setAttribute("transform",`translate(0,${n*t.Ks*2})`),l=({addedNodes:[e]})=>{e.removeAttribute("transform"),e.classList.add("frozen")},i={collection:e=>t=>{t[0].addedNodes.length&&t.forEach(l),10===e.children.length&&a(e)},dragon:e=>t=>{t[0].addedNodes.length&&t.forEach((({addedNodes:e})=>{e.forEach((e=>c(e,0)))})),e.children.length>2&&a(e)},flower:e=>t=>{t[0].addedNodes.length&&(t.forEach(l),a(e))},stacking:e=>t=>{t.forEach((({addedNodes:t})=>{t.forEach((t=>{c(t,(0,o.O)(e.children,t)-1)}))}))}};e.VY.forEach((e=>{new MutationObserver(i[e.dataset.slotType](e)).observe(e,{childList:!0})}))})()})();